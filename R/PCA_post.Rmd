---
title: "Projection"
author: "Carla"
date: "2024-02-13"
output: html_document
---

```{r include=TRUE}
# Instalar y cargar los paquetes necesarios si aún no lo has hecho
library(phyloseq)
library(dplyr)
library(tidyr)
```

Creamos el objeto phyloseq con el que crearemos la PCA a partir del output .h5ad que genera hacer proyección con MOBER 

```{r include=TRUE}
# Especifica la ruta al directorio que contiene los archivos CSV
csv_directory <- "C:/Users/Carla/Desktop/4o/Q1/TFG/samples/output/"

otu_file <- list.files(path = csv_directory, pattern = "otu_table.csv", full.names = TRUE)
sample_file <- list.files(path = csv_directory, pattern = "sample_data.csv", full.names = TRUE)

otu <- read.csv(otu_file, row.names = 1)
sample_data <- read.csv(sample_file, row.names = 1)

otu_table <- otu_table(otu, taxa_are_rows = FALSE)
sample_data <- sample_data(sample_data)

# Crear objeto phyloseq
physeq_output <- phyloseq(otu_table, sample_data)
physeq_output
```

Representamos PCA

```{r include=TRUE}
otu_table_o <- otu_table(physeq_output)
otu_post <- as.matrix(otu_table_o)

metadata_output <- sample_data(physeq_output)
meta_post <- as.matrix(metadata_output)
meta_post <- as.data.frame(meta_post)

pca_post <- pca(X = otu_post, ncomp = 2)
plot_pca_post <- PLSDAbatch::Scatter_Density(object = pca_post,
                                               batch = meta_post[,"project"],
                                               trt = meta_post[,"status"],
                                               batch.legend.title = 'Project',
                                               trt.legend.title = 'Status',
                                               title = 'With correction',
                                               xlim = c(-5000, 1000), 
                                               ylim = c(-2500, 2500))
```

